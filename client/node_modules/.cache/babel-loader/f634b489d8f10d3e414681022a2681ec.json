{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect } from \"react\";\nimport axios from \"axios\";\nexport default function UseAuth(code) {\n  _s();\n\n  const credentials = JSON.parse(localStorage.getItem(\"credentials\"));\n  useEffect(() => {\n    if (credentials === null) {\n      axios.post(\"http://localhost:3001/callback/\", {\n        code,\n        credentials\n      }).then(res => {\n        console.log(res);\n        const {\n          accessToken,\n          expiresIn,\n          refreshToken\n        } = res.data || {};\n        const credsObj = {\n          accessToken,\n          expiresIn,\n          refreshToken,\n          timeTokenExpiresMS: Date.now() + expiresIn * 1000\n        };\n        localStorage.setItem(\"credentials\", JSON.stringify(credsObj));\n        window.history.pushState({}, null, \"/\");\n      }).catch(err => {\n        console.log(err);\n        window.location = \"/\";\n      });\n    }\n\n    if (credentials) {\n      const refreshToken = JSON.parse(localStorage.getItem(\"credentials\")).refreshToken;\n      const timeTokenExpiresMS = JSON.parse(localStorage.getItem(\"credentials\")).timeTokenExpiresMS; // if (Date.now() >= timeTokenExpiresMS) {\n\n      axios.post(\"http://localhost:3001/refresh\", {\n        refreshToken\n      }).then(res => {\n        console.log(res.data);\n        const credentials = {\n          refreshToken,\n          accessToken: res.data.accessToken,\n          expiresIn: res.data.expiresIn,\n          timeTokenExpiresMS: Date.now() + res.data.expiresIn * 1000\n        };\n        localStorage.setItem(\"credentials\", JSON.stringify(credentials));\n      }).catch(reason => {\n        console.log(reason);\n      }); // }\n    }\n  }, [code, credentials]);\n}\n\n_s(UseAuth, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\n_c = UseAuth;\n\nvar _c;\n\n$RefreshReg$(_c, \"UseAuth\");","map":{"version":3,"sources":["C:/Users/Emma/OneDrive/Documents/Spectral-Music/client/src/Authentication/useAuthentication.js"],"names":["useEffect","axios","UseAuth","code","credentials","JSON","parse","localStorage","getItem","post","then","res","console","log","accessToken","expiresIn","refreshToken","data","credsObj","timeTokenExpiresMS","Date","now","setItem","stringify","window","history","pushState","catch","err","location","reason"],"mappings":";;AAAA,SAASA,SAAT,QAA0B,OAA1B;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,eAAe,SAASC,OAAT,CAAiBC,IAAjB,EAAuB;AAAA;;AACpC,QAAMC,WAAW,GAAGC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,aAArB,CAAX,CAApB;AACAR,EAAAA,SAAS,CAAC,MAAM;AACd,QAAII,WAAW,KAAK,IAApB,EAA0B;AACxBH,MAAAA,KAAK,CACFQ,IADH,CACQ,iCADR,EAC2C;AACvCN,QAAAA,IADuC;AAEvCC,QAAAA;AAFuC,OAD3C,EAKGM,IALH,CAKSC,GAAD,IAAS;AACbC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACA,cAAM;AAAEG,UAAAA,WAAF;AAAeC,UAAAA,SAAf;AAA0BC,UAAAA;AAA1B,YAA2CL,GAAG,CAACM,IAAJ,IAAY,EAA7D;AACA,cAAMC,QAAQ,GAAG;AACfJ,UAAAA,WADe;AAEfC,UAAAA,SAFe;AAGfC,UAAAA,YAHe;AAIfG,UAAAA,kBAAkB,EAAEC,IAAI,CAACC,GAAL,KAAaN,SAAS,GAAG;AAJ9B,SAAjB;AAMAR,QAAAA,YAAY,CAACe,OAAb,CAAqB,aAArB,EAAoCjB,IAAI,CAACkB,SAAL,CAAeL,QAAf,CAApC;AACAM,QAAAA,MAAM,CAACC,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,IAA7B,EAAmC,GAAnC;AACD,OAhBH,EAiBGC,KAjBH,CAiBUC,GAAD,IAAS;AACdhB,QAAAA,OAAO,CAACC,GAAR,CAAYe,GAAZ;AACAJ,QAAAA,MAAM,CAACK,QAAP,GAAkB,GAAlB;AACD,OApBH;AAqBD;;AACD,QAAIzB,WAAJ,EAAiB;AACf,YAAMY,YAAY,GAAGX,IAAI,CAACC,KAAL,CACnBC,YAAY,CAACC,OAAb,CAAqB,aAArB,CADmB,EAEnBQ,YAFF;AAGA,YAAMG,kBAAkB,GAAGd,IAAI,CAACC,KAAL,CACzBC,YAAY,CAACC,OAAb,CAAqB,aAArB,CADyB,EAEzBW,kBAFF,CAJe,CAOf;;AACElB,MAAAA,KAAK,CACFQ,IADH,CACQ,+BADR,EACyC;AACrCO,QAAAA;AADqC,OADzC,EAIGN,IAJH,CAISC,GAAD,IAAS;AACbC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAG,CAACM,IAAhB;AACA,cAAMb,WAAW,GAAG;AAClBY,UAAAA,YADkB;AAElBF,UAAAA,WAAW,EAAEH,GAAG,CAACM,IAAJ,CAASH,WAFJ;AAGlBC,UAAAA,SAAS,EAAEJ,GAAG,CAACM,IAAJ,CAASF,SAHF;AAIlBI,UAAAA,kBAAkB,EAAEC,IAAI,CAACC,GAAL,KAAaV,GAAG,CAACM,IAAJ,CAASF,SAAT,GAAqB;AAJpC,SAApB;AAMAR,QAAAA,YAAY,CAACe,OAAb,CAAqB,aAArB,EAAoCjB,IAAI,CAACkB,SAAL,CAAenB,WAAf,CAApC;AACD,OAbH,EAcGuB,KAdH,CAcUG,MAAD,IAAY;AACjBlB,QAAAA,OAAO,CAACC,GAAR,CAAYiB,MAAZ;AACD,OAhBH,EARa,CAyBf;AACD;AACF,GAnDQ,EAmDN,CAAC3B,IAAD,EAAOC,WAAP,CAnDM,CAAT;AAoDD;;GAtDuBF,O;;KAAAA,O","sourcesContent":["import { useEffect } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nexport default function UseAuth(code) {\r\n  const credentials = JSON.parse(localStorage.getItem(\"credentials\"));\r\n  useEffect(() => {\r\n    if (credentials === null) {\r\n      axios\r\n        .post(\"http://localhost:3001/callback/\", {\r\n          code,\r\n          credentials,\r\n        })\r\n        .then((res) => {\r\n          console.log(res)\r\n          const { accessToken, expiresIn, refreshToken } = res.data || {};\r\n          const credsObj = {\r\n            accessToken,\r\n            expiresIn,\r\n            refreshToken,\r\n            timeTokenExpiresMS: Date.now() + expiresIn * 1000,\r\n          };\r\n          localStorage.setItem(\"credentials\", JSON.stringify(credsObj));\r\n          window.history.pushState({}, null, \"/\");\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n          window.location = \"/\";\r\n        });\r\n    }\r\n    if (credentials) {\r\n      const refreshToken = JSON.parse(\r\n        localStorage.getItem(\"credentials\")\r\n      ).refreshToken;\r\n      const timeTokenExpiresMS = JSON.parse(\r\n        localStorage.getItem(\"credentials\")\r\n      ).timeTokenExpiresMS;\r\n      // if (Date.now() >= timeTokenExpiresMS) {\r\n        axios\r\n          .post(\"http://localhost:3001/refresh\", {\r\n            refreshToken,\r\n          })\r\n          .then((res) => {\r\n            console.log(res.data);\r\n            const credentials = {\r\n              refreshToken,\r\n              accessToken: res.data.accessToken,\r\n              expiresIn: res.data.expiresIn,\r\n              timeTokenExpiresMS: Date.now() + res.data.expiresIn * 1000,\r\n            };\r\n            localStorage.setItem(\"credentials\", JSON.stringify(credentials));\r\n          })\r\n          .catch((reason) => {\r\n            console.log(reason);\r\n          });\r\n      // }\r\n    }\r\n  }, [code, credentials]);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}