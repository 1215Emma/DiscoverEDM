{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect } from \"react\";\nimport axios from \"axios\";\nexport default function UseAuth(code) {\n  _s();\n\n  const credentials = JSON.parse(localStorage.getItem(\"credentials\"));\n  useEffect(() => {\n    if (credentials === null) {\n      axios.post(\"http://localhost:3001/callback/\", {\n        code,\n        credentials\n      }).then(res => {\n        const {\n          accessToken,\n          expiresIn,\n          refreshToken\n        } = res.data || {};\n        const credsObj = {\n          accessToken,\n          expiresIn,\n          refreshToken,\n          timeTokenExpiresMS: Date.now() + expiresIn * 1000\n        };\n        localStorage.setItem(\"credentials\", JSON.stringify(credsObj));\n        window.history.pushState({}, null, \"/\");\n      }).catch(err => {\n        console.log(err);\n        window.location = \"/\";\n      });\n    }\n\n    if (credentials) {\n      const refreshToken = JSON.parse(localStorage.getItem(\"credentials\")).refreshToken;\n      const timeTokenExpiresMS = JSON.parse(localStorage.getItem(\"credentials\")).timeTokenExpiresMS;\n\n      if (Date.now() >= timeTokenExpiresMS) {\n        axios.post(\"http://localhost:3001/refresh\", {\n          refreshToken\n        }).then(res => {\n          console.log(res.data);\n          const credentials = {\n            refreshToken,\n            accessToken: res.data.accessToken,\n            expiresIn: res.data.expiresIn,\n            timeTokenExpiresMS: Date.now() + res.data.expiresIn * 1000\n          };\n          localStorage.setItem(\"credentials\", JSON.stringify(credentials));\n        }).catch(reason => {\n          console.log(reason);\n        });\n      }\n    }\n  }, [code, credentials]);\n}\n\n_s(UseAuth, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\n_c = UseAuth;\n\nvar _c;\n\n$RefreshReg$(_c, \"UseAuth\");","map":{"version":3,"sources":["C:/Users/Emma/OneDrive/Documents/Spectral-Music/client/src/Authentication/useAuthentication.js"],"names":["useEffect","axios","UseAuth","code","credentials","JSON","parse","localStorage","getItem","post","then","res","accessToken","expiresIn","refreshToken","data","credsObj","timeTokenExpiresMS","Date","now","setItem","stringify","window","history","pushState","catch","err","console","log","location","reason"],"mappings":";;AAAA,SAASA,SAAT,QAA0B,OAA1B;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,eAAe,SAASC,OAAT,CAAiBC,IAAjB,EAAuB;AAAA;;AACpC,QAAMC,WAAW,GAAGC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,aAArB,CAAX,CAApB;AACAR,EAAAA,SAAS,CAAC,MAAM;AACd,QAAII,WAAW,KAAK,IAApB,EAA0B;AACxBH,MAAAA,KAAK,CACFQ,IADH,CACQ,iCADR,EAC2C;AACvCN,QAAAA,IADuC;AAEvCC,QAAAA;AAFuC,OAD3C,EAKGM,IALH,CAKSC,GAAD,IAAS;AACb,cAAM;AAAEC,UAAAA,WAAF;AAAeC,UAAAA,SAAf;AAA0BC,UAAAA;AAA1B,YAA2CH,GAAG,CAACI,IAAJ,IAAY,EAA7D;AACA,cAAMC,QAAQ,GAAG;AACfJ,UAAAA,WADe;AAEfC,UAAAA,SAFe;AAGfC,UAAAA,YAHe;AAIfG,UAAAA,kBAAkB,EAAEC,IAAI,CAACC,GAAL,KAAaN,SAAS,GAAG;AAJ9B,SAAjB;AAMAN,QAAAA,YAAY,CAACa,OAAb,CAAqB,aAArB,EAAoCf,IAAI,CAACgB,SAAL,CAAeL,QAAf,CAApC;AACAM,QAAAA,MAAM,CAACC,OAAP,CAAeC,SAAf,CAAyB,EAAzB,EAA6B,IAA7B,EAAmC,GAAnC;AACD,OAfH,EAgBGC,KAhBH,CAgBUC,GAAD,IAAS;AACdC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACAJ,QAAAA,MAAM,CAACO,QAAP,GAAkB,GAAlB;AACD,OAnBH;AAoBD;;AACD,QAAIzB,WAAJ,EAAiB;AACf,YAAMU,YAAY,GAAGT,IAAI,CAACC,KAAL,CACnBC,YAAY,CAACC,OAAb,CAAqB,aAArB,CADmB,EAEnBM,YAFF;AAGA,YAAMG,kBAAkB,GAAGZ,IAAI,CAACC,KAAL,CACzBC,YAAY,CAACC,OAAb,CAAqB,aAArB,CADyB,EAEzBS,kBAFF;;AAGA,UAAIC,IAAI,CAACC,GAAL,MAAcF,kBAAlB,EAAsC;AACpChB,QAAAA,KAAK,CACFQ,IADH,CACQ,+BADR,EACyC;AACrCK,UAAAA;AADqC,SADzC,EAIGJ,IAJH,CAISC,GAAD,IAAS;AACbgB,UAAAA,OAAO,CAACC,GAAR,CAAYjB,GAAG,CAACI,IAAhB;AACA,gBAAMX,WAAW,GAAG;AAClBU,YAAAA,YADkB;AAElBF,YAAAA,WAAW,EAAED,GAAG,CAACI,IAAJ,CAASH,WAFJ;AAGlBC,YAAAA,SAAS,EAAEF,GAAG,CAACI,IAAJ,CAASF,SAHF;AAIlBI,YAAAA,kBAAkB,EAAEC,IAAI,CAACC,GAAL,KAAaR,GAAG,CAACI,IAAJ,CAASF,SAAT,GAAqB;AAJpC,WAApB;AAMAN,UAAAA,YAAY,CAACa,OAAb,CAAqB,aAArB,EAAoCf,IAAI,CAACgB,SAAL,CAAejB,WAAf,CAApC;AACD,SAbH,EAcGqB,KAdH,CAcUK,MAAD,IAAY;AACjBH,UAAAA,OAAO,CAACC,GAAR,CAAYE,MAAZ;AACD,SAhBH;AAiBD;AACF;AACF,GAlDQ,EAkDN,CAAC3B,IAAD,EAAOC,WAAP,CAlDM,CAAT;AAmDD;;GArDuBF,O;;KAAAA,O","sourcesContent":["import { useEffect } from \"react\";\r\nimport axios from \"axios\";\r\n\r\nexport default function UseAuth(code) {\r\n  const credentials = JSON.parse(localStorage.getItem(\"credentials\"));\r\n  useEffect(() => {\r\n    if (credentials === null) {\r\n      axios\r\n        .post(\"http://localhost:3001/callback/\", {\r\n          code,\r\n          credentials,\r\n        })\r\n        .then((res) => {\r\n          const { accessToken, expiresIn, refreshToken } = res.data || {};\r\n          const credsObj = {\r\n            accessToken,\r\n            expiresIn,\r\n            refreshToken,\r\n            timeTokenExpiresMS: Date.now() + expiresIn * 1000,\r\n          };\r\n          localStorage.setItem(\"credentials\", JSON.stringify(credsObj));\r\n          window.history.pushState({}, null, \"/\");\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n          window.location = \"/\";\r\n        });\r\n    }\r\n    if (credentials) {\r\n      const refreshToken = JSON.parse(\r\n        localStorage.getItem(\"credentials\")\r\n      ).refreshToken;\r\n      const timeTokenExpiresMS = JSON.parse(\r\n        localStorage.getItem(\"credentials\")\r\n      ).timeTokenExpiresMS;\r\n      if (Date.now() >= timeTokenExpiresMS) {\r\n        axios\r\n          .post(\"http://localhost:3001/refresh\", {\r\n            refreshToken,\r\n          })\r\n          .then((res) => {\r\n            console.log(res.data);\r\n            const credentials = {\r\n              refreshToken,\r\n              accessToken: res.data.accessToken,\r\n              expiresIn: res.data.expiresIn,\r\n              timeTokenExpiresMS: Date.now() + res.data.expiresIn * 1000,\r\n            };\r\n            localStorage.setItem(\"credentials\", JSON.stringify(credentials));\r\n          })\r\n          .catch((reason) => {\r\n            console.log(reason);\r\n          });\r\n      }\r\n    }\r\n  }, [code, credentials]);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}